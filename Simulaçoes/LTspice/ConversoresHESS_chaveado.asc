Version 4
SHEET 1 2244 924
WIRE -368 -208 -576 -208
WIRE -576 -176 -576 -208
WIRE -368 -176 -368 -208
WIRE -1744 -144 -1840 -144
WIRE -1504 -144 -1744 -144
WIRE -1248 -144 -1376 -144
WIRE -1120 -144 -1248 -144
WIRE -832 -144 -880 -144
WIRE -1504 -112 -1536 -112
WIRE -832 -112 -880 -112
WIRE -416 -96 -448 -96
WIRE -832 -80 -880 -80
WIRE -1840 -64 -1840 -144
WIRE -1888 -48 -1920 -48
WIRE -576 -48 -576 -96
WIRE 752 -48 672 -48
WIRE -1536 -32 -1536 -112
WIRE -1488 -32 -1536 -32
WIRE -368 -32 -368 -80
WIRE -368 -32 -416 -32
WIRE -288 -32 -368 -32
WIRE 32 -32 -208 -32
WIRE 256 -32 32 -32
WIRE 304 -32 256 -32
WIRE 416 -32 304 -32
WIRE 512 -32 416 -32
WIRE 672 -32 672 -48
WIRE -2128 0 -2208 0
WIRE -1920 0 -2000 0
WIRE -1888 0 -1920 0
WIRE -576 0 -576 -48
WIRE -368 16 -368 -32
WIRE 32 16 32 -32
WIRE 256 16 256 -32
WIRE 304 16 304 -32
WIRE 416 16 416 -32
WIRE 512 16 512 -32
WIRE -2128 32 -2160 32
WIRE -1840 32 -1840 16
WIRE -1120 48 -1184 48
WIRE -832 48 -880 48
WIRE 464 48 448 48
WIRE 672 64 672 48
WIRE -832 80 -880 80
WIRE -1520 96 -1648 96
WIRE -1344 96 -1392 96
WIRE -416 96 -448 96
WIRE 96 96 80 96
WIRE -2160 112 -2160 32
WIRE -2112 112 -2160 112
WIRE -832 112 -880 112
WIRE 256 112 256 80
WIRE 304 112 304 80
WIRE 304 112 256 112
WIRE -2208 128 -2208 0
WIRE -1520 128 -1552 128
WIRE 416 128 416 96
WIRE 512 128 512 96
WIRE 512 128 416 128
WIRE -1648 144 -1648 96
WIRE -1184 144 -1184 48
WIRE -1744 160 -1744 -144
WIRE -1696 160 -1744 160
WIRE -576 160 -576 80
WIRE -368 160 -368 112
WIRE -208 160 -272 160
WIRE -128 160 -208 160
WIRE 32 160 32 112
WIRE 32 160 -48 160
WIRE 96 160 32 160
WIRE 304 160 304 112
WIRE 416 160 416 128
WIRE 752 176 752 -48
WIRE 800 176 752 176
WIRE 1040 176 992 176
WIRE -1920 208 -1920 0
WIRE -1760 208 -1920 208
WIRE -1696 208 -1760 208
WIRE -1552 208 -1552 128
WIRE -1504 208 -1552 208
WIRE -544 208 -608 208
WIRE -272 208 -272 160
WIRE -208 208 -208 160
WIRE 32 208 32 160
WIRE 800 208 672 208
WIRE 1040 208 992 208
WIRE -2208 224 -2208 208
WIRE -1648 240 -1648 224
WIRE -608 240 -608 208
WIRE 800 240 304 240
WIRE 1040 240 992 240
WIRE -1184 256 -1184 224
WIRE 304 256 304 240
WIRE 672 256 672 208
WIRE 112 288 80 288
WIRE -272 320 -272 272
WIRE -208 320 -208 272
WIRE -208 320 -272 320
WIRE -608 352 -608 320
WIRE -272 352 -272 320
WIRE 32 352 32 304
WIRE 304 352 304 336
WIRE 672 352 672 336
FLAG -576 160 0
FLAG -448 -96 HBT
IOPIN -448 -96 BiDir
FLAG -368 160 0
FLAG -416 -32 MBT
IOPIN -416 -32 BiDir
FLAG -832 -144 HBT
IOPIN -832 -144 BiDir
FLAG -832 -80 LBT
IOPIN -832 -80 BiDir
FLAG -448 96 LBT
IOPIN -448 96 BiDir
FLAG -832 -112 MBT
IOPIN -832 -112 BiDir
FLAG 304 160 0
FLAG 416 160 0
FLAG -576 -208 Vbt
FLAG -1488 -32 I1
IOPIN -1488 -32 In
FLAG 416 -32 Vbus
FLAG -2208 224 0
FLAG -2208 0 ref
FLAG -2112 112 Vd
IOPIN -2112 112 In
FLAG -1504 208 I2
IOPIN -1504 208 In
FLAG -1920 -48 0
FLAG -1840 32 0
FLAG -1648 240 0
FLAG -1344 96 erroSC
IOPIN -1344 96 Out
FLAG -832 48 HSC
IOPIN -832 48 BiDir
FLAG -832 112 LSC
IOPIN -832 112 BiDir
FLAG -832 80 MSC
IOPIN -832 80 BiDir
FLAG -272 352 0
FLAG 112 288 LSC
IOPIN 112 288 BiDir
FLAG 32 352 0
FLAG 96 160 MSC
IOPIN 96 160 BiDir
FLAG 96 96 HSC
IOPIN 96 96 BiDir
FLAG -272 160 Vsc
FLAG -1248 -144 ErroBT
FLAG -1184 256 0
FLAG 672 352 0
FLAG 672 208 Ibt
FLAG 304 352 0
FLAG 304 240 Isc
FLAG 1040 208 I1
IOPIN 1040 208 Out
FLAG 1040 240 I2
IOPIN 1040 240 Out
FLAG 1040 176 Vd
IOPIN 1040 176 Out
FLAG 672 64 0
FLAG -608 352 0
FLAG -544 208 DesgasteBateria
FLAG 464 48 w
FLAG -576 -48 e
FLAG -1760 208 Iref
SYMBOL voltage -576 -16 R0
WINDOW 3 32 76 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 0
SYMATTR Value 7.2
SYMATTR InstName V1
SYMBOL ind -304 -16 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 200µ
SYMATTR SpiceLine Ipk=6 Rser=15m
SYMBOL nmos -416 -176 R0
WINDOW 3 56 60 Left 2
SYMATTR Value irfz44n
SYMATTR InstName M1
SYMATTR Prefix X
SYMBOL cap 288 16 R0
SYMATTR InstName C1
SYMATTR Value 680µ
SYMATTR SpiceLine V=100 Rser=15m Lser=500p Rpar=12Meg
SYMBOL cap 240 16 R0
SYMATTR InstName C3
SYMATTR Value 1µ
SYMBOL carga_motor 384 16 R0
SYMATTR InstName X1
SYMBOL controladorPI -1440 -128 R0
WINDOW 39 0 -23 Bottom 2
SYMATTR SpiceLine P=0.42 I=1100 max=5 min=0
SYMATTR InstName X2
SYMBOL voltage -2208 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
WINDOW 3 -80 156 Left 2
SYMATTR Value EXP(1 7 0 .3m 60m 2m)
SYMATTR InstName V2
SYMBOL controladorPI -1456 112 R0
WINDOW 39 0 -23 Bottom 2
SYMATTR SpiceLine P=0.4 I=1000 max=20 min=-20
SYMATTR InstName X4
SYMBOL controladorPI -2064 16 R0
WINDOW 39 0 -23 Bottom 2
SYMATTR SpiceLine P=1.5 I=1200 min=-20
SYMATTR InstName X5
SYMBOL ind -144 176 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value 120µ
SYMATTR SpiceLine Ipk=29 Rser=20m
SYMBOL cap -288 208 R0
SYMATTR InstName C2
SYMATTR Value 66
SYMATTR SpiceLine Irms=80 Rser=20m Rpar=8k
SYMBOL cap -224 208 R0
SYMATTR InstName C4
SYMATTR Value 10µ
SYMATTR SpiceLine Rser=1m Lser=1n
SYMBOL modulador_PWM_driver -1008 -112 R0
SYMATTR InstName X6
SYMBOL modulador_PWM_driver -1008 80 R0
SYMATTR InstName X7
SYMBOL e2 -1648 128 R0
WINDOW 3 24 96 Invisible 2
SYMATTR Value 1
SYMATTR InstName E2
SYMBOL e2 -1840 -80 R0
WINDOW 3 15 93 Left 2
SYMATTR Value Laplace=1/(1+tau*s)
SYMATTR InstName E1
SYMBOL nmos -416 16 R0
WINDOW 3 56 60 Left 2
SYMATTR Value irfz44n
SYMATTR InstName M2
SYMATTR Prefix X
SYMBOL nmos 80 16 M0
WINDOW 3 56 60 Left 2
SYMATTR Value irfz44n
SYMATTR InstName M3
SYMATTR Prefix X
SYMBOL nmos 80 208 M0
WINDOW 3 56 60 Left 2
SYMATTR Value irfz44n
SYMATTR InstName M4
SYMATTR Prefix X
SYMBOL bv -1184 128 R0
SYMATTR InstName B3
SYMATTR Value V= 1/pow( limit( 1, V(erroSC), 10 ), 2 )
SYMBOL bv 672 240 R0
SYMATTR InstName B1
SYMATTR Value V=I(L1)+.1*rand(time*1e6)-.05
SYMBOL bv 304 240 R0
SYMATTR InstName B2
SYMATTR Value V=I(L2)+.1*rand(time*1e6)-.05
SYMBOL frontend_analog 896 176 R0
SYMATTR InstName X3
SYMBOL bv 672 -48 R0
SYMATTR InstName B4
SYMATTR Value V=V(Vbus)+.1*random(time*1e5)-.05
SYMBOL res 496 0 R0
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res -560 -80 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R2
SYMATTR Value 200m
SYMBOL bv -608 224 R0
SYMATTR InstName B5
SYMATTR Value V= idt( V(Vbt,N004)*I(R2) )
TEXT 848 -48 Left 2 !.tran 0 60 1.5m startup
TEXT -2040 -144 Left 2 !.param tau=14
TEXT 40 -200 Left 2 !.ic V(Vsc)=6\n.ic I(L1)=0\n.ic I(L2)=0\n.ic V(Vbus)=0
TEXT 840 -192 Left 2 !.options reltol=1e-3\n.options gmin 1e-10\n.options maxstep=26u
TEXT 840 -80 Left 2 !.inc irfz44n.spi
